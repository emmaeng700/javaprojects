<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('Dashboard - Batch Service')}"></head>
<body>
<nav th:replace="~{fragments/layout :: navbar}"></nav>

<div class="container">
    <h1>Batch Processing Dashboard</h1>

    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>

    <div class="stats">
        <div class="stat-card">
            <div class="number" th:text="${peopleCount}">0</div>
            <div class="label">People in Database</div>
        </div>
        <div class="stat-card">
            <div class="number" th:text="${#lists.size(executions)}">0</div>
            <div class="label">Job Executions</div>
        </div>
    </div>

    <div class="card">
        <h3>Run Batch Job</h3>
        <p>Import people from the CSV file and transform names to uppercase.</p>
        <br/>
        <form th:action="@{/run-job}" method="post">
            <button type="submit" class="btn btn-primary">Run Import Job</button>
        </form>
    </div>

    <div class="card" th:if="${not #lists.isEmpty(executions)}">
        <h3>Recent Executions</h3>
        <table>
            <thead>
            <tr>
                <th>Job ID</th>
                <th>Status</th>
                <th>Start Time</th>
                <th>End Time</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="exec : ${executions}">
                <td th:text="${exec.jobId}"></td>
                <td>
                    <span class="badge"
                          th:classappend="${exec.status.name() == 'COMPLETED'} ? 'badge-completed' : (${exec.status.name() == 'STARTED'} ? 'badge-started' : 'badge-failed')"
                          th:text="${exec.status}"></span>
                </td>
                <td th:text="${exec.startTime}"></td>
                <td th:text="${exec.endTime}"></td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<footer th:replace="~{fragments/layout :: footer}"></footer>
</body>
</html>
